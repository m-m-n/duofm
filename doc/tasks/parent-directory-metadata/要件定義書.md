# 要件定義書: 親ディレクトリメタデータ表示

## 概要

親ディレクトリエントリ（..）のタイムスタンプが `0001-01-01 00:00` と表示されるバグを修正し、実際の親ディレクトリのメタデータ（更新日時、パーミッション、所有者、グループ）を正しく表示する。

## ビジネス要件

### 背景
- 現在、親ディレクトリ（..）エントリを作成する際、`ModTime`などのメタデータフィールドが設定されていない
- Goの`time.Time`のゼロ値は`0001-01-01 00:00:00`となるため、不正な日時が表示されている
- ユーザーにとって混乱を招く表示となっている

### 目的
- ファイル一覧の表示品質を向上させる
- 親ディレクトリの正確な情報を提供する
- 他のエントリと一貫性のある表示を実現する

## ユースケース

### UC-1: 親ディレクトリの情報確認
- **アクター**: ユーザー
- **前提条件**: ルートディレクトリ以外のディレクトリを開いている
- **基本フロー**:
  1. ユーザーがファイル一覧を表示する
  2. 親ディレクトリ（..）エントリが一覧の先頭に表示される
  3. タイムスタンプ、パーミッション、所有者、グループが正しく表示される
- **期待結果**: 親ディレクトリの実際のメタデータが表示される

## 機能要件

### FR-1: 親ディレクトリのメタデータ取得
- 親ディレクトリのパスを`filepath.Dir()`で取得する
- `os.Stat()`で以下の情報を取得する：
  - 更新日時（ModTime）
  - パーミッション（Mode）
- 既存の`GetFileOwnerGroup()`関数で以下を取得する：
  - 所有者名
  - グループ名

### FR-2: エラーハンドリング
- メタデータ取得に失敗した場合でも、親ディレクトリエントリは表示する
- 取得できなかったフィールドはデフォルト値（ゼロ値または"unknown"）のまま

### FR-3: ルートディレクトリの考慮
- ルートディレクトリ（/）では親ディレクトリエントリを表示しない（既存動作を維持）

## 非機能要件

### NFR-1: パフォーマンス
- 追加のシステムコールは2回のみ（`os.Stat` + `GetFileOwnerGroup`）
- ディレクトリ内のファイル数に関係なく固定のオーバーヘッド
- 既存処理と同等のパフォーマンス特性

### NFR-2: 保守性
- 既存の関数（`GetFileOwnerGroup`）を再利用する
- 通常エントリと同じ処理パターンを採用する

## 制約条件

- 既存のAPIインターフェース（`ReadDirectory`関数）は変更しない
- `FileEntry`構造体は変更しない

## 成功基準

1. 親ディレクトリのタイムスタンプが実際の更新日時を表示する
2. 親ディレクトリのパーミッションが正しく表示される
3. 親ディレクトリの所有者・グループが正しく表示される
4. 既存のテストがすべてパスする
5. パフォーマンスに顕著な劣化がない

## テストシナリオ

### TS-1: 正常系
- 通常のディレクトリで親ディレクトリのメタデータが正しく取得される
- タイムスタンプが`0001-01-01`ではないことを確認

### TS-2: ルートディレクトリ
- ルートディレクトリでは親ディレクトリエントリが表示されない

### TS-3: エラー時
- 親ディレクトリへのアクセス権限がない場合でも、エントリ自体は表示される

## 確認済み事項

| 項目 | 決定内容 | 確認日 |
|------|---------|--------|
| 表示方針 | 親ディレクトリの実際のメタデータを表示 | 2025-12-21 |
| パフォーマンス | 既存処理と同等、懸念なし | 2025-12-21 |
| 対象フィールド | ModTime, Permissions, Owner, Group | 2025-12-21 |

## 影響範囲

### 変更対象ファイル
- `internal/fs/reader.go` - `ReadDirectory`関数の修正

### 影響を受ける機能
- ファイル一覧表示（両ペイン）
