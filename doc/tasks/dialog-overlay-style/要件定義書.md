# 要件定義書: ダイアログオーバーレイスタイルの改善

## 概要

ダイアログ表示時の背景ペインの見た目を改善する。現在はアクティブペインが完全に塗りつぶされて元のファイルリストが見えなくなるが、元のテキストを維持したままグレー背景を適用し、視認性を保ちつつダイアログを強調する。

## ビジネス要件

### 目的
- ダイアログ表示時に元のファイルリストを確認できるようにする
- 視覚的にダサくない、洗練された見た目を実現する
- ダイアログの強調は維持する

### 対象ユーザー
- duofmの全ユーザー

### 解決する問題
- 現状: ダイアログ表示時に背景が█文字で塗りつぶされ、元のリストが完全に見えなくなる
- 改善後: 元のテキストが見えつつ、背景がグレーになりダイアログが強調される

## 機能要件

### FR-1: 背景ペインのスタイル変更

ダイアログ表示時、対象ペインは以下のスタイルで再描画される：

1. **背景色**: 濃いグレー（元の黒ではなく）
2. **テキスト色**: 通常より暗い色（「後ろに引っ込んでいる」効果）
3. **元のテキスト**: ファイル名、サイズ、日時などは維持される

### FR-2: ダイアログの表示位置と背景変更範囲

ダイアログは表示位置によって2種類に分類され、それぞれ背景変更範囲が異なる：

#### 全体（中央）表示ダイアログ
- **表示位置**: 画面全体の中央
- **背景変更範囲**: 左右両方のペイン
- **対象ダイアログ**:
  - ヘルプダイアログ（`?`キー）
  - エラーダイアログ

#### アクティブペイン表示ダイアログ
- **表示位置**: 操作を行ったペインの中央
- **背景変更範囲**: 操作を行ったペインのみ（反対側は通常表示）
- **対象ダイアログ**:
  - 確認ダイアログ（削除時の`d`キーなど）
  - コンテキストメニュー（`@`キー）

## 非機能要件

### NFR-1: パフォーマンス

- 既存の描画ロジックを活用し、スタイルのみ変更する
- 追加のパフォーマンス負荷は発生しない

### NFR-2: 保守性

- スタイル定義は一箇所で管理し、全ダイアログで共通利用する

## UI/UX要件

### 視覚的な要件

#### アクティブペイン表示ダイアログ（例: 削除確認、コンテキストメニュー）

左ペインで`d`キーを押した場合：
```
┌────────────────────────────────────────────────────────────────┐
│ duofm v0.1.0                                                   │
├────────────────────────────┬───────────────────────────────────┤
│ [グレー背景・暗いテキスト] │ [通常表示]                        │
│  .git/                     │  Documents/                       │
│  cmd/       ╭────────────╮ │  Pictures/                        │
│  doc/       │ Delete?    │ │  Videos/                          │
│  internal/  │            │ │  Downloads/                       │
│  go.mod     │ example.txt│ │  Music/                           │
│  go.sum     │            │ │                                   │
│  Makefile   │ [y] [n]    │ │                                   │
│             ╰────────────╯ │                                   │
├────────────────────────────┴───────────────────────────────────┤
│ 1/8                                                            │
└────────────────────────────────────────────────────────────────┘
```

#### 全体（中央）表示ダイアログ（例: ヘルプ、エラー）

```
┌────────────────────────────────────────────────────────────────┐
│ duofm v0.1.0                                                   │
├────────────────────────────┬───────────────────────────────────┤
│ [グレー背景・暗いテキスト] │ [グレー背景・暗いテキスト]        │
│  .git/                     │  Documents/                       │
│  cmd/              ╭───────────────────╮             Pictures/ │
│  doc/              │   Keybindings     │             Videos/   │
│  internal/         │                   │             Downloads/│
│  go.mod            │   j/k: move...    │             Music/    │
│  go.sum            │   h/l: pane...    │                       │
│  Makefile          │   ?: help         │                       │
│                    ╰───────────────────╯                       │
├────────────────────────────┴───────────────────────────────────┤
│ 1/8                                                            │
└────────────────────────────────────────────────────────────────┘
```

### 色の指定

- 背景色: 濃いグレー（lipgloss Color "236" または同等の暗いグレー）
- テキスト色: 暗めのグレー（lipgloss Color "243" または同等）

## 技術的アプローチ

### 実装方針

1. `Pane`構造体に「ダイアログオーバーレイモード」用の描画メソッドを追加
2. `Dialog`インターフェースに表示タイプ（全体/ペイン）を示すメソッドを追加
3. `model.go`のダイアログ描画部分で、ダイアログの種類に応じて背景変更範囲を切り替える

### 変更対象ファイル

- `internal/ui/pane.go`: オーバーレイスタイル用の描画機能追加
- `internal/ui/dialog.go`: ダイアログ表示タイプのインターフェース追加
- `internal/ui/help_dialog.go`: 全体表示タイプを返すよう実装
- `internal/ui/error_dialog.go`: 全体表示タイプを返すよう実装
- `internal/ui/confirm_dialog.go`: ペイン表示タイプを返すよう実装
- `internal/ui/context_menu_dialog.go`: ペイン表示タイプを返すよう実装
- `internal/ui/model.go`: ダイアログ描画時の処理変更

## 制約条件

- 既存のダイアログ機能に影響を与えない
- lipglossライブラリの機能範囲内で実装する

## 成功基準

1. ダイアログ表示時、背景ペインのファイルリストが視認できる
2. 背景がグレーになり、テキストが暗くなることでダイアログが強調される
3. 全体表示ダイアログ（ヘルプ、エラー）では左右両方の背景が変更される
4. ペイン表示ダイアログ（確認、コンテキストメニュー）では操作ペインのみ背景が変更される
5. パフォーマンスに影響がない

## テストシナリオ

| # | シナリオ | 期待結果 |
|---|----------|----------|
| 1 | `?`キーでヘルプダイアログを表示 | **左右両方**がグレー背景・暗いテキスト、ダイアログは画面中央 |
| 2 | 左ペインで`d`キーを押して削除確認を表示 | **左ペインのみ**グレー背景、右ペインは通常表示、ダイアログは左ペイン中央 |
| 3 | 右ペインで`d`キーを押して削除確認を表示 | **右ペインのみ**グレー背景、左ペインは通常表示、ダイアログは右ペイン中央 |
| 4 | 左ペインで`@`キーを押してコンテキストメニューを表示 | **左ペインのみ**グレー背景、右ペインは通常表示 |
| 5 | 右ペインで`@`キーを押してコンテキストメニューを表示 | **右ペインのみ**グレー背景、左ペインは通常表示 |
| 6 | エラーダイアログを表示 | **左右両方**がグレー背景、ダイアログは画面中央 |
| 7 | ダイアログを閉じる | 背景ペインが通常のスタイルに戻る |

## 確認済み事項

- [x] 方法B（スタイル変更して再描画）を採用
- [x] テキスト色は暗くして「後ろに引っ込んでいる」効果を出す
- [x] 全てのダイアログに適用する
- [x] パフォーマンスへの影響は問題なし
- [x] ヘルプ・エラー: 全体（中央）表示、左右両方の背景変更
- [x] 削除確認・コンテキストメニュー: アクティブペイン表示、操作ペインのみ背景変更
