# 要件定義書: ソートトグル機能

## 概要

duofmにソートトグル機能を追加する。`s`キーを押すとソート設定ダイアログが表示され、ユーザーがソート項目（名前/サイズ/日付）と順序（昇順/降順）を選択できるようにする。

## 目的

- ファイルを様々な順序（名前、サイズ、日付）で表示できるようにする
- キーボード操作のみでソート変更を可能にする
- 各ペインで独立したソート設定を維持する

## 機能要件

### FR-1: ソートダイアログの表示

**概要**: `s`キーでソート設定ダイアログを表示する

**ダイアログ表示**:
```
┌─ Sort ─────────────────────────┐
│                                │
│  Sort by    [Name]  Size  Date │
│  Order       ↑Asc  [↓Desc]     │
│                                │
│  h/l:change  j/k:row           │
│  Enter:OK  Esc:cancel          │
└────────────────────────────────┘
```

**構成要素**:
- **Sort by行**: ソート項目の選択（Name / Size / Date）
- **Order行**: ソート順序の選択（↑Asc / ↓Desc）
- **操作説明**: 2行に分けて表示
  - 1行目: ダイアログ内ナビゲーション
  - 2行目: ダイアログ確定/キャンセル

### FR-2: ダイアログ操作

**キーバインド**:

| キー | 動作 |
|------|------|
| `h` / `←` | 左の選択肢へ移動 |
| `l` / `→` | 右の選択肢へ移動 |
| `k` / `↑` | 上の行へ移動（Order → Sort by） |
| `j` / `↓` | 下の行へ移動（Sort by → Order） |
| `Enter` | 確定して閉じる |
| `Esc` / `q` | キャンセル（元のソートに戻す） |

**動作**:
- ダイアログ表示時、現在のソート設定が選択状態で表示される
- 選択変更は即時にファイル一覧に反映される（プレビュー）
- `Enter`で確定、`Esc`でキャンセル（変更前の状態に戻る）
- フォーカス中の行はハイライト表示
- 選択中の項目は`[ ]`で囲んで表示

### FR-3: ソート項目

**Sort by（ソート項目）**:
| 項目 | 説明 |
|------|------|
| Name | ファイル名でソート |
| Size | ファイルサイズでソート |
| Date | 更新日時でソート |

**Order（ソート順序）**:
| 順序 | 表示 | 説明 |
|------|------|------|
| 昇順 | ↑Asc | A→Z / 小→大 / 古→新 |
| 降順 | ↓Desc | Z→A / 大→小 / 新→古 |

**デフォルト**: Name + ↑Asc（名前昇順）

### FR-4: ディレクトリ優先表示

**概要**: ソート順序に関わらず、ディレクトリは常にファイルより先に表示する

**動作**:
- 親ディレクトリ（`..`）は常に最上部に表示
- ディレクトリ同士は現在のソートモードに従ってソート
- ファイル同士は現在のソートモードに従ってソート
- ディレクトリグループがファイルグループより上に表示

### FR-5: ペイン独立設定

**概要**: 各ペインは独立したソート設定を持つ

**動作**:
- 左ペインと右ペインで異なるソート設定が可能
- アクティブペインのソート設定のみ変更される
- ペイン切り替え時、各ペインのソート設定は維持

### FR-6: 設定の非永続化

**概要**: ソート設定はアプリ終了時に破棄される

**動作**:
- アプリ起動時は常に「名前昇順」で開始
- ディレクトリ移動時もソート設定は維持
- 設定ファイルへの保存は行わない

### FR-7: カーソル位置の維持

**概要**: ソート変更後も現在選択中のファイルにカーソルを維持する

**動作**:
- ソート適用後、同じファイル名のエントリにカーソルを移動
- ファイルが見つからない場合は現在のインデックスを維持
- インデックスが範囲外の場合は最後のエントリを選択

## 非機能要件

### NFR-1: パフォーマンス

- 10,000ファイルのディレクトリでも200ms以内にソート完了
- ソート処理はメインスレッドで実行（ブロッキング許容）

### NFR-2: 操作性

- vim風キーバインド（hjkl）と矢印キーの両方をサポート
- 選択変更の即時プレビューでユーザーに視覚的フィードバック

## ユーザーストーリー

1. ユーザーとして、大きいファイルから順に表示したいので、`s`キーでダイアログを開き、Size + ↓Descを選択したい
2. ユーザーとして、最近更新したファイルを探したいので、Date + ↓Descでソートしたい
3. ユーザーとして、左ペインは名前順、右ペインは日付順で表示したい
4. ユーザーとして、ソート変更をプレビューしながら確認し、気に入らなければEscでキャンセルしたい

## 受け入れ条件

- [ ] `s`キーでソートダイアログが表示される
- [ ] h/l/j/kキーと矢印キーでダイアログ内を移動できる
- [ ] Enterで確定、Escでキャンセルできる
- [ ] 選択変更が即時にファイル一覧に反映される
- [ ] ディレクトリは常にファイルより先に表示される
- [ ] ソート変更後、同じファイルが選択された状態を維持
- [ ] 左右ペインで独立したソート設定が可能
- [ ] アプリ再起動で名前昇順にリセットされる
- [ ] 既存機能（コピー、移動、削除、マーク等）に影響がない
