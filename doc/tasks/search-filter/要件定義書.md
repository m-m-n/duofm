# 要件定義書: 検索・フィルタ機能

## 概要

アクティブペイン内のファイル一覧を検索・フィルタリングする機能を実装する。
ユーザーはキーボード操作で素早くファイルを見つけることができる。

## 目的

- 大量のファイルがあるディレクトリで目的のファイルを素早く見つける
- インクリメンタルサーチによるリアルタイムフィルタリング
- 正規表現による高度なパターンマッチング

## 機能要件

### 1. インクリメンタルサーチ（`/`）

- `/` キーでミニバッファを開き、検索モードに入る
- 入力中はリアルタイムでファイル一覧をフィルタリング
- マッチしないファイルは非表示
- `Enter` で確定、`Esc` でキャンセル

### 2. 正規表現検索（`Ctrl+F`）

- `Ctrl+F` キーでミニバッファを開き、正規表現検索モードに入る
- プレフィックス `(search)` を表示
- `Enter` で検索実行・確定、`Esc` でキャンセル

### 3. 検索状態管理

- `/` と `Ctrl+F` は排他的に動作
- 検索確定後、別の検索モードを開始すると前の検索はリセット
- 空文字列で `Enter` すると検索解除（全ファイル表示）

### 4. 大文字小文字の扱い

- **Smart Case** を採用
  - 検索パターンがすべて小文字: 大文字小文字を無視
  - 検索パターンに大文字が含まれる: 大文字小文字を区別

## 非機能要件

### パフォーマンス

- フィルタリング処理: 1000ファイル以下で10ms未満
- キー入力から表示更新まで50ms以内

### ユーザビリティ

- ミニバッファは画面下部に表示
- 現在の検索モード（`/` or `(search)`）を明示
- フィルタ結果が0件の場合もUIは応答性を維持

## 対象外

- サブディレクトリの再帰検索
- ファイル内容の検索（grep的機能）
- 検索履歴の保存

## 用語定義

| 用語 | 定義 |
|------|------|
| ミニバッファ | アクティブペインの下部に表示される1行テキスト入力エリア。Emacsに着想を得た軽量な入力方式で、モーダルダイアログを使わずに検索パターンを入力できる。検索中のみ表示され、確定またはキャンセルで非表示になる。 |
| インクリメンタルサーチ | 入力中にリアルタイムで結果が更新される検索 |
| フィルタ | マッチしないアイテムを非表示にする処理 |
| Smart Case | パターンに大文字が含まれる場合のみ大文字小文字を区別 |

## UI例

```
duofm v0.1.0
 ~/src/my_projects/go/duofm                               ~
 Marked 0/10 0 B                           922.5 GiB Free Marked 0/61 0 B                           922.5 GiB Free
 ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────
 ..                                        -  2025-12-17  ..                                        -  2021-02-02
 cmd/                                      -  2025-12-18  AI/                                       -  2025-09-28
 doc/                                      -  2025-12-21  Documents/                                -  2025-12-01
 internal/                                 -  2025-12-21  Downloads/                                -  2025-12-20
 /: cmd                                                   ← ミニバッファ（アクティブペイン下部）
```

- ミニバッファはアクティブペイン（左）の下部に表示
- `/: ` はインクリメンタルサーチのプロンプト
- `(search): ` は正規表現検索のプロンプト
